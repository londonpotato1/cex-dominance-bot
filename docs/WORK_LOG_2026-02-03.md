# Work Log – 2026-02-03

## 목적
따리가이드 + 텔레그램 복기 자료를 구조화하여 상장/아비트라지 분석용 데이터셋으로 통합하고,
데이터 수집 봇 설계/DB 스키마까지 연결.

---

## 오늘까지 완료된 작업

### 1) 따리가이드/복기 자료 구조화
- PDF 텍스트 클린업 및 전체 요약 완료 (이미 수행됨)
- 복기/사례 정리 CSV에 대표 케이스 추가  
  - 날짜 미기재 대표 사례: MANTA/AVAIL/MINA/CKB/MOVE/ME 추가됨
  - 파일: `docs/guide_listing_cases.csv`

### 2) 텔레그램 Export 파싱/정리
- HTML exports 전체 파싱 (3개 폴더)
- 원문 메시지 2,605건 수집
  - `data/telegram_exports/raw_messages.csv`
  - `data/telegram_exports/raw_messages.jsonl`
- 복기 케이스 17건 추출/정규화
  - `data/telegram_exports/bokgi_cases.csv`
  - `data/telegram_exports/bokgi_cases.json`
- 가이드/전략 메시지 481건 추출
  - `data/telegram_exports/guide_notes.csv`
  - `data/telegram_exports/guide_notes.json`
- 상장/따리 관련 가이드 필터(228건)
  - `data/telegram_exports/guide_notes_listing.csv`
  - `data/telegram_exports/guide_notes_listing.json`
- 가이드 요약 테이블 생성
  - `data/telegram_exports/guide_notes_listing_summary.csv`

### 3) 복기 케이스 → labeling 스키마 매핑
- 텔레그램 복기 케이스를 labeling 포맷으로 내보냄
  - `data/labeling/telegram_bokgi_enriched.csv`
  - `data/labeling/telegram_bokgi_enriched_v2.csv`
- `listing_data.csv` 병합 완료
  - 새 병합 파일: `data/labeling/listing_data_bokgi_merged_v2.csv`
  - 실제 반영 파일: `data/labeling/listing_data.csv`
  - 백업: `data/labeling/listing_data_before_bokgi_merge.csv`

### 4) guide_listing_cases.csv 정규화 컬럼 확장
- 확장 컬럼:
  - `exchange`, `listing_type`, `network_chain`, `hot_wallet_usd`, `max_premium_pct`, `result_label`,
    `profit_pct`, `market_cap_usd`, `deposit_krw`, `hedge_type`, `dex_liquidity_usd`,
    `withdrawal_open`, `airdrop_claim_rate`, `notes_norm`
- 자동 추출/채우기 스크립트:
  - `scripts/normalize_guide_listing_cases.py`

### 5) 수집 봇 설계 문서 및 DB 스키마
- 설계 문서:
  - `docs/DATA_COLLECTION_BOT_DESIGN.md`
- DB 스키마:
  - `docs/db_schema.sql`

---

## 사용한 주요 스크립트

- Telegram 파이프라인 (원문/복기/가이드/guide CSV 병합)
  - `scripts/telegram_bokgi_pipeline.py`
- Telegram 후처리 (가이드 필터/요약, bokgi 정규화, listing_data 병합)
  - `scripts/telegram_postprocess.py`
- guide_listing_cases 정규화
  - `scripts/normalize_guide_listing_cases.py`

---

## 현재 데이터셋 상태 (요약)

- `docs/guide_listing_cases.csv`
  - 총 52건
  - 텔레그램 복기 17건 포함
  - 대표 사례(MANTA/AVAIL/MINA/CKB/MOVE/ME) 포함
  - 정규화 컬럼 확장 완료

- `data/telegram_exports`
  - 원문 메시지 2,605건
  - 복기 17건
  - 가이드 481건
  - 상장/따리 관련 가이드 228건

- `data/labeling/listing_data.csv`
  - 텔레그램 복기 17건 병합 완료

---

## 내일 바로 이어서 할 구현 로드맵

### A. guide_listing_cases.csv 정밀 보강
1) `bokgi_manual_enrichment.csv` 수동 채우기
   - 경로: `data/labeling/bokgi_manual_enrichment.csv`
   - 채우기 대상: entry_method, exit_method, funding_rate, premium_range, dex_used, chain_used, deposit_krw_exact
2) 정규화 스키마에서 부족한 필드 추가 자동화
   - hot wallet 추정치, 현선갭/펀비 정교 파싱
3) 고정 규칙 확장 (예: “입금액 40억”, “현선 0.5%” 등)

### B. 수집 봇 구현 시작 (MVP)
1) Collectors skeleton 생성
   - `collectors/announcements/` (업비트/빗썸/코인원)
   - `collectors/market/` (현물/선물 가격/펀딩비/현선갭)
   - `collectors/wallets/` (핫월렛 입출금)
2) DB 초기화 스크립트 생성
   - `docs/db_schema.sql` 기준으로 SQLite/PG 초기화
3) 정규화 레이어 추가
   - 심볼/체인/시간 정규화

### C. 분석/스코어링 연결
1) 라벨 데이터 기반 유사도 탐색
2) “상장/따리 후보 점수” 규칙 기반 계산
3) 알림 조건 정의 (현선갭 급증, 입금 급증, 출금 지연 등)

---

## 체크포인트 (내일 시작 전에 확인)
- `listing_data.csv`가 병합본으로 교체되어 있음 (백업 존재)
- guide_listing_cases.csv 정상 정규화 되었는지 샘플 확인 필요
- 텔레그램 exports 경로 변경 여부 확인

---

## 빠른 실행 커맨드

```powershell
# 텔레그램 파이프라인
python C:\Users\user\Documents\03_Claude\cex_dominance_bot\scripts\telegram_bokgi_pipeline.py

# 텔레그램 후처리
python C:\Users\user\Documents\03_Claude\cex_dominance_bot\scripts\telegram_postprocess.py

# guide_listing_cases 정규화
python C:\Users\user\Documents\03_Claude\cex_dominance_bot\scripts\normalize_guide_listing_cases.py
```

---

## Rule Set
- 2026-02-03: Always update this work log after each task (summary, files touched, next steps).

---

## Log Entry – 2026-02-04 02:18
- Summary: 강화된 자동 추출 규칙 적용(핫월렛/현선갭/입금액 등), 구현 설계 초안 문서 작성, DB 초기화 및 샘플 적재 스크립트 추가 후 실행.
- Files touched:
  - `scripts/normalize_guide_listing_cases.py`
  - `docs/guide_listing_cases.csv`
  - `docs/IMPLEMENTATION_DRAFT.md`
  - `scripts/init_db.py`
  - `scripts/load_sample_data.py`
  - `data/cex_listing.db`
- Next steps:
  - guide_listing_cases.csv 정밀 보강(핫월렛/현선갭/펀비 추가 규칙)
  - 샘플 적재 기준 고도화(중복 방지/자산-체인 매핑 강화)

---

## Log Entry – 2026-02-04 02:22
- Summary: guide_listing_cases 정밀 파싱 강화(펀비/현선갭 범위), 샘플 적재 중복 방지 로직 보강, 리포트 쿼리/CSV 생성 추가.
- Files touched:
  - `scripts/normalize_guide_listing_cases.py`
  - `docs/guide_listing_cases.csv`
  - `scripts/load_sample_data.py`
  - `docs/report_queries.sql`
  - `scripts/run_reports.py`
  - `data/reports/*`
- Next steps:
  - 샘플 적재 중복 레코드 정리 여부 결정
  - 리포트 쿼리 확장(결과 라벨별 분포/현선갭-수익률 상관)

---

## Log Entry – 2026-02-04 02:24
- Summary: 사용자 요청에 따라 전체 진행 요약/사용 방법/로드맵 단계 안내 제공.
- Files touched:
  - `docs/WORK_LOG_2026-02-03.md`
- Next steps:
  - DB 중복 정리 여부 결정

---

## Log Entry – 2026-02-04 02:25
- Summary: listing_cases 중복 정리 스크립트 추가 및 실행(중복 없음 확인). DB 백업 생성.
- Files touched:
  - `scripts/dedup_listing_cases.py`
  - `data/cex_listing_before_dedup.db`
- Next steps:
  - guide_listing_cases 수동 보강(`bokgi_manual_enrichment.csv`)
  - Collector/Normalizer/Feature 모듈 골격 구현

---

## Log Entry – 2026-02-04 02:31
- Summary: bokgi 수동보강 자동 프리필 생성, normalizers/feature 모듈 골격 추가.
- Files touched:
  - `scripts/telegram_postprocess.py`
  - `data/labeling/bokgi_manual_enrichment_prefill.csv`
  - `normalizers/*`
  - `features/*`
- Next steps:
  - bokgi_manual_enrichment_prefill.csv 수동 보강
  - collector 모듈 구현 시작

---

## Log Entry – 2026-02-04 02:44
- Summary: 수집 모듈 구현 시작(공지 수집 → DB 저장), DB storage 헬퍼 추가.
- Files touched:
  - `collectors/storage.py`
  - `scripts/notice_collector_runner.py`
- Next steps:
  - notice_collector_runner 실행 테스트
  - market/funding/wallet collector DB 저장 연동

---

## Log Entry – 2026-02-04 02:49
- Summary: 공지 수집 테스트 실행, KoreanNoticeFetcher 프리패치 연동(상장만 저장) 및 실행 확인.
- Files touched:
  - `scripts/notice_collector_runner.py`
  - `data/cex_listing.db`
- Next steps:
  - 공지 수집 장시간 실행 테스트
  - (선택) 입출금/주의 공지 저장 범위 확장 여부 결정

---

## Log Entry – 2026-02-04 02:54
- Summary: 공지 이벤트 테이블 추가, 공지 수집기에서 비상장 공지까지 DB 저장 확장, 공지 수집 테스트 실행.
- Files touched:
  - `collectors/notice_fetcher.py`
  - `collectors/storage.py`
  - `scripts/notice_collector_runner.py`
  - `docs/db_schema.sql`
  - `data/cex_listing.db`
- Next steps:
  - notice_events 저장 범위/중복 정책 점검
  - 상장 이벤트 발생 시 listing_events 자동 적재 확인

---

## Log Entry – 2026-02-04 03:00
- Summary: notice_events 중복 정책 강화, 상장 이벤트 삽입 테스트 성공, 공지 수집 60초 장시간 테스트 완료.
- Files touched:
  - `collectors/storage.py`
  - `scripts/test_notice_insertion.py`
  - `scripts/notice_collector_runner.py`
  - `data/cex_listing.db`
- Next steps:
  - 실제 상장 공지 발생 시 listing_events 자동 저장 모니터링

---

## Log Entry – 2026-02-04 11:00
- Summary: notice_events 중복 정책 강화 완료, listing_outcomes 테이블/저장 함수/트래커 추가, 트래커 테스트 실행(테스트 심볼 미존재로 스냅샷 없음).
- Files touched:
  - `docs/db_schema.sql`
  - `collectors/storage.py`
  - `scripts/listing_outcome_tracker.py`
  - `data/cex_listing.db`
- Next steps:
  - 실제 상장 심볼 대상으로 트래커 검증
  - wallet_flows 연동 시 입금액 자동 계산 추가
